---
title: "router.refresh() が何をしているのか理解する"
---

## 公式によると...

https://arc.net/l/quote/jxtudbaj

> `router.refresh()`: 現在のルートを更新します。サーバーに新しいリクエストを行い、データリクエストを再取得し、Server Component を再レンダリングします。クライアントは、更新された React Server Component のペイロードを、影響を受けないクライアント側の React（useState など）やブラウザの状態（スクロール位置など）を保持したままマージします。

上記内容を箇条書きでまとめると以下の通りになります。

- 現在のルートを更新する
- サーバーに新しいリクエストを行う
- Server Component を再レンダリングする
- クライアントは、サーバーから受け取った新たな RSC ペイロードを、クライアント側の React（useState など）やブラウザの状態（スクロール位置など）を保持したままマージする

## どういうこと？

箇条書きでまとめた項目を一つずつ見ていきます。

### 現在のルートを更新する

`router.refresh()` を実行した Root Segment（ページ）を更新するという意味です。
しかし後述によると、「更新」と言ってもページ全体を 0 から再構築しているわけではいようです。
つまり、単純にページをリロードしている（`window.location.reload()` を実行している）わけではないということです。
それではこの「更新」とは一体何をしているのでしょうか？

### サーバーに新しいリクエストを行う

「新たにサーバーリクエストする」という観点だと `window.location.reload()` と同じですね。
`router.refresh()` は何をリクエストしているのでしょうか？

### Server Component を再レンダリングする

どうやら Server Component を再レンダリングし、RSC ペイロードを生成しているようです。
「Server Component を**再レンダリング**する」とありますが、これはサーバー側で再度 RSC ペイロードを生成し直しているだけです。

### クライアントは、サーバーから受け取った新たな RSC ペイロードを、クライアント側の React（useState など）やブラウザの状態（スクロール位置など）を保持したままマージする

こちらはどういうことでしょうか？
再生成した RSC を用いてクライアント側で再描画することは分かります。しかし、「クライアント側の React やブラウザの状態を保持したままマージする」というのは本当なのでしょうか？
こちらを確認するために、ToDo アプリを作成して検証してみます。

## ToDo アプリを実装して `router.refresh()` の動作を検証する

## `router.refresh()` は Router Cache をパージする
