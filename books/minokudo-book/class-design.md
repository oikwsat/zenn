---
title: "クラス設計"
---

- 保守や変更がしやすいコードには、関心の分離が重要
- オブジェクト指向は、ロジック整理の方針がわかりやすく、関心の分離が容易
- オブジェクト指向は、ソフトウェアの品質向上を目的とする考え方
- 「クラスベース」とは、データとロジックをクラスにひとまとめにし、プログラムの構造を定義していく手法

## クラス単位で正常に動作するよう設計する

まず重要なのが「**クラスが単体で正常動作するよう設計する**」こと。
まどろっこしい初期設定をせずともはじめから使える設計にする。
また、バグを生み出さないよう、正しく操作できるメソッドのみを外部に提供する。

### 頑固なクラスの構成要素

クラスの構成要素は以下の 2 つ。

- インスタンス変数
- メソッド

この構成を、弊害を招きづらいものにするには、メソッドの役割を明確化する必要がある。
それを踏まえた、良いクラスの構成要素は以下のようになる。

- インスタンス変数
- **インスタンス変数を不正状態から防御し、正常に操作するメソッド**

上記**両方**を備えたクラスが弊害を防ぐ武器になる。

:::details 良いクラスの構成

![](https://storage.googleapis.com/zenn-user-upload/e1a89da8a949-20240915.png)
メソッドは必ずインスタンス変数を使用する。

:::

:::details 良くないクラスの構成

![](https://storage.googleapis.com/zenn-user-upload/35454d074cf6-20240915.png)
メソッド、インスタンス変数のどちらが欠けても良くない。
ただし、目的によっては例外的に許容される場合がある。

:::

何故これらを守らなければならないのか？
それは、データクラスによる以下の弊害が発生するからである。

- 重複コード
- 修正漏れ
- 可読性低下
- 未初期化状態
- 不正値の混入

データクラスでは、インスタンスを生成した直後はインスタンス変数が不正状態だあり、初期化処理をしなければバグになる。
そして、初期化処理は別のクラスに実装されている。

また、どんな値でもインスタンス変数に出し入れ可能であったため、不正値が容易に混入する作りでもあった。
不正値から防御するためのバリデーションは別のクラスに実装されており、データクラス自身に自分を守るロジックは用意されていない。

:::message
このような状態では、「クラスが単体で正常動作するよう設計されている」と言えない。
データクラスは他のクラスがないと正常動作できない、未熟なクラスである。
:::

### すべてのクラスに自己防衛責務を持たせる

ソフトウェアはメソッド、クラス、モジュール、どの粒度でも、単体でバグがなく、いつでも安全に利用できる品質が求められる。
他のクラスに初期化やバリデーションをしてもらうクラスは未熟。

**自己防衛責務をすべてのクラスが備えることが品質を考える上で重要**。
構成部品であるクラス一つ一つが完結していることが、全体の品質を向上させる。

## 成熟したクラスへ成長させる設計術

以下は、金額を表す `Money` クラス。

```java
import java.util.Currency;

class Money {
    int amount;      // 金額値
    Currency currency; // 通貨単位
}
```

このクラスは、データクラスであり、未熟なため、改善していく。

### 1. コンストラクタで確実に正常値を設定する

**未初期化状態（生焼けオブジェクト）** を防ぐ。
そのためには、「インスタンス生成時に、インスタンス変数に正常値が確実に設定されている状態」にする。

```java
class Money {
    int amount;
    Currency currency;

    Money(int amount, Currency currency) {
        this.amount = amount;
        this.currency = currency;
    }
}
```

上記で、インスタンス変数を確実に初期化できる。
しかし、これでは不十分。
「不正値の混入」が発生する可能性がある。

```java
Money money = new Money(-100, null);
```

「不正値の混入」を防ぐために、コンストラクタ内にバリデーションを実装する。
不正値の場合、例外をスローする。

:::details 正常値のルール

- 金額 `amount` : 0 以上の整数
- 通過 `currency` : null 以外

:::
