---
title: "WebSocket"
---

## WebSocket とは

- プロトコルの一種
- クライアントと Web サーバとの間で双方向通信を行うための軽量なプロトコル
- ゲームや SNS など、リアルタイム性が要求されるアプリで採用される
- Web サーバ側からブラウザに対して通信を行うことができる

## WebSocket の必要性

WebSocket は、HTTP プロトコルでは実現しづらい、あるいは効率的には実現できない以下の項目を補完することができる。

### サーバプッシュ

サーバー側でデータが更新された場合、WebSocket を使用してクライアントにプッシュ通知を送信できる。
これにより、リアルタイムの更新やイベントの通知などが実現できる。

HTTP では、ブラウザから Web サーバに対してリクエストを送信できても、逆に Web サーバからブラウザに対して接続を試みることはできない。
Web サーバの情報が更新されたかどうかは、ブラウザ側から決まったタイミングでリクエストを送る必要がある。
しかし、WebSocket では、一度 Web サーバとブラウザ間で接続が確立すれば、Web サーバとブラウザのどちらからでも接続を開始できる。

![](https://storage.googleapis.com/zenn-user-upload/763f990119ed-20230807.png)

### 低遅延

WebSocket はコネクションを維持し続けるため、新しいリクエストを送信するたびにコネクションを確立する必要がない。
このため、通信の遅延が少なく、効率的なデータ転送が可能。

### オーバーヘッドの削減

HTTP リクエストにはヘッダ情報が含まれ、コネクションを確立するたびにこのヘッダ情報を再送する必要がある。
しかし、WebSocket では一度コネクションを確立すれば、ヘッダ情報の再送が必要なくなり、通信のオーバーヘッドを削減できる。

## WebSocket による通信の仕組み

![](https://storage.googleapis.com/zenn-user-upload/3c62ecf780d5-20230807.png)

通信手順は以下の通り。

1. HTTP でクライアント側がサーバ側に対してハンドシェイクリクエストを送信する
   - Upgrede ヘッダを使用し、プロトコルの変更を行う
2. サーバ側がハンドシェイクレスポンスを返して、コネクションを確立
   - ステータスコード 101 `Switching Protocols`
3. HTTP から WebSocket へプロトコルが変更し、WebSocket コネクションが開始する

WebSocket では、URL のスキームに「**ws:**」が使用される。
セキュリティで保護された WebSocket 接続については「**wss:**」が使用される。
