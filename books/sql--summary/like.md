---
title: "LIKE演算子"
---

- `LIKE` 演算子は、特定のパターンに一致する文字列を検索する際に使用される
- 主に `SELECT` 文の `WHERE` 句内で使われ、テキストデータ型のカラムに対する部分一致やパターンマッチングを行うことができる

```sql
SELECT カラム FROM テーブル
WHERE カラム LIKE パターンマッチングの条件;
```

## ワイルドカード

- パターンマッチングは「ワイルドカード」を用いて行う
- ワイルドカードとは、パターンマッチングを行う際に特定の部分を任意の文字で置き換えるための特殊文字
- 主に 2 種類のワイルドカードがある

### パーセント（`%`）

- **用途**
  - 任意の文字列（0 文字以上）にマッチする
  - 位置に関わらず、指定したパターンの前後に任意の文字が存在する場合に使用される
- **例**
  - `'a%'` : "a"で始まる任意の文字列にマッチする（"a"自身を含む）
  - `'%a'` : "a"で終わる任意の文字列にマッチする
  - `'%or%'` : 任意の位置に"or"を含む文字列にマッチする

### アンダースコア（`_`）

- **用途**
  - 任意の単一文字にマッチする
  - 固定された位置における 1 文字を指定する場合に使用される
- **例**
  - `'a_'` : "a"で始まり、任意の一文字が続く二文字の文字列にマッチする
  - `'_a'` : 任意の一文字で始まり、"a"で終わる二文字の文字列にマッチする
  - `'a__b'` : "a"で始まり、任意の二文字が続き、"b"で終わる四文字の文字列にマッチする

## LIKE 演算子の具体例

- **任意の文字列を含むレコードの検索**

  - `'John%'`は、"John"で始まる任意の文字列にマッチする

  ```sql
  SELECT * FROM Employees WHERE Name LIKE 'John%';
  ```

- **特定の位置の文字を指定して検索**

  - `'J_hn'`は、"J"で始まり、任意の一文字を挟んで"hn"で終わる文字列にマッチする

  ```sql
  SELECT * FROM Employees WHERE Name LIKE 'J_hn';
  ```

- **特定のパターンを含まないレコードの検索**
  - `NOT LIKE`を使用して特定のパターンを含むレコードを除外する
  ```sql
  SELECT * FROM Employees WHERE Name NOT LIKE 'John%';
  ```

## ワイルドカードのエスケープ処理

- ワイルドカード（`%`, `_`）の文字をリテラル（文字そのものとして）で検索したい場合はエスケープ処理が必要になる
- SQL 内に　`ESCAPE` キーワードを使用してエスケープ文字を指定する
- このエスケープ文字をワイルドカード文字の前に置くことで、そのワイルドカードをリテラルとして検索できる

### 具体例

`%` や `_` を含むデータを `Products` テーブルから検索したい場合

- **`%` を含むデータの検索**

  ```sql
  SELECT * FROM Products WHERE Name LIKE '%\%%' ESCAPE '\';
  ```

  - このクエリは、`Name` が `%` を含む全てのレコードを検索する
  - ここでは、`\` をエスケープ文字として使用している

- **`_` を含むデータの検索**

  ```sql
  SELECT * FROM Products WHERE Name LIKE '%\_%' ESCAPE '\';
  ```

  - このクエリは、`Name` が `_` を含むすべてのレコードを検索する
  - 同様に `\` をエスケープ文字として使用している

## LIKE 演算子の使用時の注意点

- LIKE 演算子は大文字小文字を区別するかどうかがデータベースシステムに依存する
  - SQL Server では大文字小文字を区別しないが、PostgreSQL など他のシステムでは区別する設定も可能
- パフォーマンスに影響を与える可能性があるため、大きなテーブルでの使用時には注意が必要
- `%`や`_`を文字として検索する場合は、エスケープシーケンスが必要になる場合がある
