---
title: "正規表現"
---

- SQL での正規表現は、文字列のパターンマッチングを高度に行うための強力なツール
- `REGEXP`や`SIMILAR TO`といった演算子を使用して、特定のパターンに一致するレコードを検索する

## 正規表現の基本要素

| 正規表現 | 意味                                   | マッチ例                                                 |
| -------- | -------------------------------------- | -------------------------------------------------------- |
| ^        | 文字列の開始                           | `^a`は"a"で始まる任意の文字列にマッチ                    |
| $        | 文字列の終了                           | `a$`は"a"で終わる任意の文字列にマッチ                    |
| .        | 任意の単一文字                         | `a.b`は"a"と"b"の間に任意の 1 文字がある文字列にマッチ   |
| \*       | 直前の文字の 0 回以上の繰り返し        | `a*`は"aaa"や""(空文字)にマッチ                          |
| +        | 直前の文字の 1 回以上の繰り返し        | `a+`は"aaa"にマッチするが""にはマッチしない              |
| ?        | 直前の文字の 0 回または 1 回の出現     | `a?`は"a"または""(空文字)にマッチ                        |
| {n}      | 直前の文字の n 回の繰り返し            | `a{2}`は"aa"にマッチ                                     |
| {n,}     | 直前の文字の n 回以上の繰り返し        | `a{2,}`は"aa"、"aaa"などにマッチ                         |
| {n,m}    | 直前の文字の n 回から m 回の繰り返し   | `a{2,3}`は"aa"、"aaa"にマッチ                            |
| [abc]    | 指定した文字(a、b、または c)のいずれか | `a[bc]d`は"abd"、"acd"にマッチ                           |
| [^abc]   | 指定した文字以外の任意の文字           | `a[^bc]d`は"abd"、"acd"以外の"a"d で終わる文字列にマッチ |
| (xyz)    | グループ化された文字列(xyz)            | `(abc)+`は"abc"、"abcabc"にマッチ                        |

## SQL での正規表現の使用

- SQL では`LIKE`演算子の代わりに`REGEXP`や`SIMILAR TO`を使用して正規表現による検索が可能
- ただし、正規表現のサポートはデータベースシステムによって異なる

#### REGEXP

- **説明**: 特定のパターンに一致する文字列を検索する。
- **サポート**: MySQL、PostgreSQL（`~`演算子での使用）、SQLite（拡張機能を通じて）など。

#### SIMILAR TO

- **説明**: SQL 標準に基づく正規表現のパターンマッチングを提供する。`LIKE`に似ているが、より複雑なパターンに対応している。
- **サポート**: PostgreSQL など。

#### ~ (ティルダ)

- **説明**: PostgreSQL で利用可能な正規表現マッチ演算子。Perl 互換の正規表現を使用する。
- **サポート**: PostgreSQL。

## 具体例

以下の`Customers`テーブルを考える：

| CustomerID | Name        |
| ---------- | ----------- |
| 1          | Alice Smith |
| 2          | Bob Brown   |
| 3          | Charlie Lee |
| 4          | David Clark |

名前が"Smith"で終わる顧客を検索するクエリは以下のようになる：

```sql
SELECT * FROM Customers WHERE Name REGEXP 'Smith$';
```

| CustomerID | Name        |
| ---------- | ----------- |
| 1          | Alice Smith |
