---
title: "ログ"
---

## 基本的なロギング

Go の `log` パッケージはシンプルで使いやすい。基本的な使い方は次のとおり：

1. **標準ログの記録**:

   - `log.Println`, `log.Printf`, `log.Print` を使ってメッセージを記録する。
   - これらは標準出力（通常はコンソール）にメッセージを出力する。

   ```go
   log.Println("情報: アプリケーションが開始されました")
   // 出力: 2022/01/02 15:04:05 情報: アプリケーションが開始されました
   ```

2. **エラーレベルのログ**:

   - `log.Fatal` シリーズ（`log.Fatalln`, `log.Fatalf`）は、ログ出力後にプログラムを終了させる。
   - `log.Panic` シリーズ（`log.Panicln`, `log.Panicf`）は、パニックを発生させる。

   ```go

   log.Fatalln("致命的エラー: 設定ファイルが見つかりません")
   // 出力: 2022/01/02 15:04:05 致命的エラー: 設定ファイルが見つかりません
   ```

## カスタムロガーの作成

特定の要件に合わせてログの出力をカスタマイズするには、`log.New` を使ってカスタムロガーを作成する：

1. **`log.New` の使い方**:

   - `log.New` は新しいロガーを作成するための関数。
   - 基本的なシグネチャは以下の通り

   ```go
   func New(out io.Writer, prefix string, flag int) *log.Logger
   ```

   - `out io.Writer` : ログメッセージの出力先。標準出力やファイルなど、`io.Writer` インターフェースを実装する任意のオブジェクトを指定できる
   - `prefix string` : 各ログメッセージの開始に付加される文字列。例えば `"INFO: "` と設定すると、すべてのログメッセージは `"INFO: "` で始まる
   - `flag int` : ログメッセージに付随する追加情報を指定する。日付、時刻、ファイル名、行番号などを含めることができる

2. **ファイルへのログ記録**:

   - ファイルにログを記録する場合は、`os.OpenFile` を使ってログファイルを開き、それをロガーの出力先として指定する。

   ```go
   file, err := os.OpenFile("app.log", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0666)
   if err != nil {
       log.Fatal(err)
   }
   defer file.Close()

   logger := log.New(file, "INFO: ", log.Ldate|log.Ltime|log.Lshortfile)
   logger.Println("カスタムロガー")
   ```

   - `log.New` で作成したカスタムロガーを `Println` などで実行すると、`app.log` が生成され、ログが記録される

   ```log: app.log
   INFO: 2023/12/16 11:33:44 logger.go:26: カスタムロガー
   ```

3. **ログレベル**:

   - Go の標準 `log` パッケージには、ログレベル（INFO, WARN, ERROR など）を直接指定する機能はない。
   - ログレベルは、プレフィックスやカスタムロガーを使って間接的に扱うことができる。

4. **フラグのオプション**:
   - `log.Ldate` : ログメッセージに日付を含める。
   - `log.Ltime` : ログメッセージに時刻を含める。
   - `log.Lmicroseconds` : ログメッセージにマイクロ秒単位の時刻を含める。
   - `log.Llongfile` : フルファイル名と行番号を含める。
   - `log.Lshortfile` : 最終コンポーネントのファイル名と行番号を含める。
   - `log.LUTC` : 日付と時刻を UTC で記録する。
   - フラグはビット OR 演算子 (`|`) を使って組み合わせることができる

## ユースケース

#### 開発時のデバッグ

ログを使用して、変数の値やプログラムのフローを確認し、バグを特定する。

#### 運用中のアプリケーションの監視

実稼働環境でのアプリケーションの状態を監視し、問題が発生したときに迅速に対応する。

#### エラーレポート

エラー情報をログに記録し、後で分析することで、システムの安定性やセキュリティを改善する。

#### パフォーマンスモニタリング

パフォーマンスに関するデータをログに記録し、システムの最適化に役立てる。

## 締めくくり

- Go の `log` パッケージは、基本的なログ記録のニーズに対応する
- 複雑なロギング要件がある場合は、サードパーティのロギングライブラリ（例えば `zap` や `logrus`）を検討するといい
- これらはログレベル、構造化されたログ、パフォーマンスなど、より高度な機能を提供する
