---
title: "内部スキーマと物理設計"
---

## 物理設計のステップ

![](https://storage.googleapis.com/zenn-user-upload/98ff52756660-20230916.png)

## テーブル定義

- 論理設計で定義された概念スキーマをもとに、それを DBMS 内部に格納するための「テーブル」単位に変換する
- このフェーズで作られるモデルを**物理モデル**と呼ぶ

## インデックス定義

- インデックスは、データの高速検索とアクセスを可能にするデータ構造の一つ
- データベース内のテーブルやビューの特定の列に対して、効率的なデータの格納方法と検索方法を提供する
- インデックスがパフォーマンスにおいて重要な役割を果たす

:::message
インデックスを理解するには、ちょうど本の索引をイメージすると良いでしょう。特定の単語がどのページに存在するか見つけ出したいとき、1 ページ目から順にページをめくっていくのは、ページ数が多くなればなるほど非効率で時間がかかります。本の索引は、この手間を省略して、ある単語が何ページ目に書かれているかをダイレクトに示してくれるので、直接該当ページへ飛ぶことを可能にします。
:::

## ハードウェアのサイジング

- 「サイジング」には 2 種類ある
  - キャパシティ
  - パフォーマンス

### キャパシティのサイジング

- 「キャパシティ」はデータの規模
- システムで利用するデータサイズを見積もり、それに十分な容量の記憶装置（ストレージ）を選定する

キャパシティのサイジングには以下の情報が必要となる。

#### システムで利用するデータ量

- DB 内に格納するデータ量は、物理的なテーブルおよびインデックス定義の後に算出される
- 従って、論理設計の後に行う必要がある
- データ量は、DB 内に格納するテーブル以外にも、テキストや画像、HTML といった様々なものを考慮する必要がある

#### サービス終了時

- 基本的に、データ量はシステム運用開始から増加していく
- システム運用終了時にデータ量がどの程度増えるかを予測しておく必要がある

![](https://storage.googleapis.com/zenn-user-upload/768b91be2bf3-20230916.png)

- 初めからデータの量の増加を予測するのは困難な場合、以下のアプローチをとる
  1. 安全率を大きくとって、余裕を持たせたサイジングを行う
  2. 容量が不足した場合に備えて、簡単に記憶装置を追加できるような構成にする

### パフォーマンスのサイジング

- サイズを測る対象は CPU やメモリ
- 十分な性能を発揮できるだけのスペックの CPU やメモリを持ったサーバを選定する

パフォーマンスのサイジングには以下の指標が必要となる。

#### 処理時間

- 特定の処理が何秒以内に終了するのか？
- どれだけ速く処理できるか？

#### スループット

- 単位時間当たりにどれだけの処理をこなせるか？
- どれだけたくさん処理できるか？
- 「一秒当たりの仕事量」を示す**TPS**を使用する

#### リソース使用量の基礎数値

- サイジングの見積もりは難しい...
- 見積もりといっても、その根拠となる基礎数値が欲しい...
- そのため、以下の方法で基礎数値を得る
  1. 類似の稼働中システムのデータを流用する
  2. 開発の初期段階でプロトタイプシステムを構築し、性能検証を実施する

## ストレージの冗長構成

### ストレージとは？

- DB のデータを保持する媒体
- 一般的には HDD（ハードディスクドライブ）を使用する
- DB に保管されているデータは非常に重要度が高いデータであるため、耐障害性を上げる必要がある
- そのために利用される技術が**RAID**

### RAID とは？

- 複数ディスクを束ねて、**仮想敵な一つのストレージとする技術**

### RAID の基本的な考え方

- 同じデータを複数ディスクに書き込むことによって冗長化することで、安全性を高める

::: details 冗長化とは？

- 同じデータが重複して存在する状態

:::

### RAID のメリット

- 安全性の向上
- 性能の向上

### RAID 構築の流れ

- データベースの物理設計においては、RAID について以下を考える必要がある

  - 当該データに求めるのは信頼性か？性能か？
  - どのレベルの RAID を採用するか？
  - 何本のディスクで RAID を構成するか？

- 最初の問いが最も重要
- これにより、RAID のレベルやディスク本数が決まる

### RAID0（ストライビング）

![](https://storage.googleapis.com/zenn-user-upload/752c28e5ec98-20230916.png)

- 複数のディスクにデータを分散する
- 冗長性は全くない
- ディスクのうち一本でも故障すると破綻する
  - そのため、**「RAID として欠陥がある」**という意見もある
- ディスクを分散することにより、ディスク I/O の性能がかなり高い

### RAID1（ミラーリング）

![](https://storage.googleapis.com/zenn-user-upload/9a07f2ad588d-20230916.png)

- 2 本のディスクに全く同じデータを書き込む
- 信頼性が高くなる
- 性能は 1 本の時と変わらない
- ディスクの使用効率もあまり良くない

### RAID5（バリティ分散）

- 最低 3 本以上のディスクが必要になる
-
