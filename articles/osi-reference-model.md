---
title: "OSI参照モデル"
emoji: "🐈"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [ネットワーク, OSI参照モデル]
published: false
---

## ネットワークとは？

- **コンピュータ同士でデータを送受信するための仕組み**
- ネットワークにより、コンピュータがつながる

### ネットワークの種類

- **ローカルエリアネットワーク（LAN）**
  - 一つの建物やキャンパス内の小さな範囲でコンピュータを接続する
- **ワイドエリアネットワーク（WAN）**
  - 広範囲にわたってコンピュータを接続するネットワーク
  - インターネットは WAN

### ネットワークには約束事（ルール）が必要

https://zenn.dev/itpassport/articles/03bd090fa135ba#%E3%81%BE%E3%81%9A%E3%81%AF%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%92%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%81%A7%E3%81%A8%E3%82%89%E3%81%88%E3%82%88%E3%81%86

## OSI 参照モデルとは？

- ネットワークのルールを標準化したもの
- 国際標準化機構（ISO）が提案したモデル
- 通信プロセスを 7 つのレイヤー（層）に分けた

### なぜルールを標準化する必要があるのか？

> 私の家の LAN と Amazon の LAN でデータの送受信する場合は、国際標準として定められた OSI 参照 モデルという通信ルールに従う必要がある。なぜなら、私が Amazon に対し、コミュニケーションを取って通信ルールを指定することができないから。
> 私の LAN と実家の家の LAN でデータを送受信する場合も、何も考えたくなければ OSI 参照 モデルという通信ルールを採用すればいい。しかし、何かこだわりがある場合、独自の通信ルールを使用することができる。
> なぜなら、私と実家はコミュニケーションを取ることができるから。

### 7 階層の内訳

![](https://storage.googleapis.com/zenn-user-upload/5255eaf8139f-20240501.png)

![](https://storage.googleapis.com/zenn-user-upload/94e884460cab-20240501.png)

## 物理層

https://zenn.dev/itpassport/articles/4a664c57e97822

### 責務

- 送信するビットデータ（0 と 1 のやつ）を電気信号に変換する
- 変換後の電気信号を LAN を通して受信側のコンピュータに届ける
- 受信する電気信号をビットデータ（0 と 1 のやつ）に変換する

### 責務の果たし方

:::details 送信するビットデータ（0 と 1 のやつ）を電気信号に変換する方法

コンピュータに付属している **NIC** がビットデータを電気信号に変換してくれる。

:::

:::details 変換後の電気信号を LAN を通して受信側のコンピュータに届ける方法

- LAN ケーブルを通る電気信号は途中で弱くなっていき、受信したときには元データと異なっている場合がある
- この問題を防ぐために、LAN の中継地点にリピータ（リピータハブ）と呼ばれるデバイスを設置し、弱まった電気信号を増幅させる
- 複数のコンピュータが LAN に接続されている場合、その電気信号がどのコンピュータかは判断せず、すべてのコンピュータに転送される
- データを受け取ったコンピュータは自分宛のデータでなければ破棄する
- 特定のコンピュータのみにデータを送信できないのは、リピータ（リピータハブ）の能力不足が原因
- リピータ（リピータハブ）の責務は受け取った電気信号を増幅し、そのまま流すことであり、送信先を特定することはしない

:::

:::details 受信する電気信号をビットデータ（0 と 1 のやつ）に変換する方法
コンピュータに付属している NIC が電気信号をビットデータに変換してくれる。
:::

### プロトコル

あとで書く

## データリンク層

https://zenn.dev/itpassport/articles/4a664c57e97822

### 責務

- リピータ（リピータハブ）の責務外である、「送信先のコンピュータを特定する」を担う
- データを必要なコンピュータのみに正確に送る

### 責務の果たし方

:::details どうやって送信先コンピュータを特定するのか？

- **L2 スイッチ（ブリッジ）というコンピュータが MAC アドレスを元に特定してくれる**
- L2 スイッチは LAN の中継地点に存在する
  - 物理層のリピータと同じ
- 送信元コンピュータはデータとともに宛先の MAC アドレスを付与して送信する
  - 宛先 MAC アドレスが付与されたデータを**フレーム**と呼ぶ
  - 宛先 MAC アドレスは**フレームヘッダ**という場所に格納される

:::

:::details L2 スイッチはどのようにしてデータを適切な宛先に届けるのか？

1. L2 スイッチに電気信号が届く
2. 電気信号をフレームに変換する
3. フレームヘッダから宛先の MAC アドレスを確認する
4. L2 スイッチが持つ、**MAC アドレステーブル**を参照し、どのコンピュータにデータを届けるかを判断する
5. 判断したら、実際にデータを届ける

:::

:::details L2 スイッチの MAC アドレステーブルとは？

- **定義**：
  - ネットワーク内の各デバイスの MAC アドレスとそれに対応するスイッチポートを記録したテーブル
- **機能**：
  - スイッチが受信したフレームの宛先 MAC アドレスをテーブルで検索し、適切なポートにフレームを転送するために使用される
- **動的学習**：
  - スイッチはネットワーク上のデバイスからフレームを受信するたびに、その送信元 MAC アドレスと受信ポートをテーブルに動的に記録（学習）する
- **自動更新**：
  - MAC アドレステーブルは定期的に更新され、使用されなくなったエントリは自動的に削除される（エージングと呼ばれるプロセス）
- **フレームのフィルタリングと転送**：
  - 宛先アドレスがテーブルに存在する場合、スイッチはフレームを対応するポートにのみ転送する（ユニキャスト転送）
  - 宛先アドレスがテーブルに存在しない場合、またはブロードキャスト/マルチキャストアドレスの場合、フレームはすべてのポート（または特定のポート）に転送される

:::

:::details L2 スイッチはリピータの役割も担う
現在はリピータを利用せず、リピータ機能をもった L2 スイッチを利用することがほとんど。
:::

### プロトコル

| 代表的なプロトコル | トロポジー       | アクセス制御方式   |
| ------------------ | ---------------- | ------------------ |
| イーサネット       | スター型、バス型 | CSMA/CD、CSMA/CA   |
| トークンリング     | リング型         | トークンパッシング |

現在もっとも普及しているのはイーサネット。

#### トロポジーとは？

- LAN の接続形態のこと
- 接続形態はスター型、バス型、リング型がある

:::details スター型
![](https://storage.googleapis.com/zenn-user-upload/864f6d67b54e-20240501.png)

- スイッチを中心として放射状に各コンピュータを接続する
- イーサネットで利用される

:::

:::details バス型
![](https://storage.googleapis.com/zenn-user-upload/98612b89c290-20240501.png)

- 一本の基幹となるケーブルに各コンピュータを接続する
- イーサネットで利用される

:::

:::details リング型
![](https://storage.googleapis.com/zenn-user-upload/15eee90f34b1-20240501.png)

- リング状に各コンピュータを接続する
- トークンリングで利用される

:::

#### アクセス制御方式とは？

- データリンク層における電気信号の伝達を制御する方法のこと
- 通信媒体上で生じる信号の衝突回避を目的としている

:::details CSMA/CD

- イーサネットネットワークにおいてデータの衝突を検出し、その対処を行うための**プロトコル**
- デバイスがデータを送信する前にキャリア（信号）を感知し、他のデバイスが送信中でないことを確認する
- 衝突が検出された場合（2 つ以上のデバイスが同時にデータを送信してしまった場合）、それぞれのデバイスはランダムな時間を待ってから再送を試みる

:::

:::details CSMA/CA

- 主に無線ネットワーク（Wi-Fi など）で使用される**プロトコル**で、データの衝突を事前に回避することを目的とする
- デバイスがキャリアを感知して他のデバイスが送信中でないことを確認する
- しかし、送信前に「RTS/CTS」（Request to Send / Clear to Send）メッセージを使って送信権を確保し、他のデバイスの送信を一時停止させることで衝突のリスクを減らす

:::

:::details CSMA/CD と CSMA/CD の違い

1. **適用環境**：
   - CSMA/CD は主に有線 LAN（イーサネット）で使用される
   - CSMA/CA は無線ネットワーク環境で使用される
2. **目的とメカニズム**：
   - CSMA/CD はデータ送信中に衝突が発生することを検出し、その後で対応を行う（衝突検出）
   - CSMA/CA は衝突が起こる前に回避するための措置を講じる（衝突回避）。具体的には、送信権の確保と他デバイスの送信の一時停止を行う
3. **衝突の処理**：
   - CSMA/CD では、衝突後に各デバイスがランダムな時間を待ってから再送を試みることで衝突に対処する
   - CSMA/CA では、衝突を事前に回避するために通信を制御し、必要に応じて通信の順番を調整する

- CSMA/CD は衝突後の対処方法を取り決めたルール
- CSMA/CA はそもそもデータの衝突を起こさないようにするために取り決めたルール
- 有線 LAN では一度衝突した後でも迅速に再送が可能であるため、衝突後の対処を行う CSMA/CD を採用している
- 無線 LAN ではなるべくデータ衝突による干渉を避けたいため、そもそもデータ衝突をさせない CSMA/CA を採用している

:::

:::details トークンバッシング

- **定義**:
  - トークンと呼ばれる特別なデータパケットがネットワーク内の各デバイスを順に回る方式
- **排他制御**:
  - データを送信できるのはトークンを持っているデバイスのみで、トークンを受け取ったデバイスのみがデータ送信の権利を持つ
- **順序付け**:
  - デバイス間でトークンが順番に渡されることで、ネットワーク上のデータの衝突を防ぐ

### トークンパッシング方式の動作

1. **トークンの生成と初期化**:
   - ネットワークの初期化時にトークンが生成され、リング上のデバイスに順に渡される
2. **トークンの受信**:
   - デバイスはトークンを受け取る
   - トークンを受け取ったデバイスは、データの送信権を得ます
3. **データの送信**:
   - トークンを保持しているデバイスは、トークンと共にデータを送信できる
   - データ送信後、トークンは次のデバイスへと渡される
4. **トークンのリリース**:
   - データ送信が完了したら、デバイスはトークンを次のデバイスへと渡す
   - これにより、次のデバイスがデータ送信の機会を得る
5. **エラーと回復**:
   - トークンの喪失や破損が発生した場合、ネットワークは特定のプロトコルに従って新しいトークンを生成し、正常な通信を回復する

### トークンパッシング方式の利点と制限

- **利点**:
  - ネットワーク上でのデータの衝突がないため、効率的なデータ転送が可能
  - 各デバイスが均等に通信の機会を得られるため、公平性が保たれる
- **制限**:
  - トークンの喪失や誤りによる通信の遅延や停止が発生する可能性がある
  - ネットワークの規模が大きくなると、トークンが各デバイスに到達するまでの時間が長くなるため、遅延が増加する

:::

## ネットワーク層

https://zenn.dev/itpassport/articles/5944d5bd936228

### 責務

異なるネットワーク同士を中継する。

![](https://storage.googleapis.com/zenn-user-upload/52a483f28dc3-20240501.png)

### 責務の果たし方

:::details L3 スイッチ（ルーター）

:::
