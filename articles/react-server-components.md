---
title: "React Server Componentsを理解する"
emoji: "📌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [react, nextjs, typescript]
published: false
---

## はじめに

- React18 から、React Server Components（RSC, SC）が登場した
- Next.js13 では、SC を標準サポートしている
- RSC の登場により、これまでのコンポーネント（js ファイルによりクライアント側で生成するコンポーネント）を Client Components（CC）と呼ぶようになった

## React Server Components とは？

- サーバ側でレンダリングされたコンポーネント
- SC の登場により、コンポーネント毎に「クライアントでレンダリングされるコンポーネント」と「サーバでレンダリングされるコンポーネント」を区別が付けられるようになった
  - 以下のように、1 つのページに SC と CC が混在するようになる
    ![](https://storage.googleapis.com/zenn-user-upload/e93e24d24658-20230924.png)

## サーバ側でレンダリング？？

RSC をレンダリングする時には、以下のような流れになる。

1. サーバがレンダリングリクエストを受け取る
2. サーバが仮想 DOM を構築し、**RSC ペイロード**と呼ばれる特別なデータ形式にシリアライズする
3. RSC ペイロードをクライアントにレスポンスする

これが、「サーバでコンポーネントを実行する」の意味。
![](https://storage.googleapis.com/zenn-user-upload/696bc3a781a8-20230924.png)

## 何のための技術なのか

SC は、「**サーバで生成できるコードはクライアントに送らずサーバ側で完結した方が良い**」という考えから出来た。
サーバ側で完結させるメリットは何か？

- JS のバンドルサイズの削減
- データフェッチスピードの高速化
- セキュリティ
- 設計面のメリット

### JS のバンドルサイズの削減

- CC は空の HTML から JS コードにより、コンポーネントを構築している
- しかし、SC はサーバ側でコンポーネントの構築が完結するため、クライアントに JS コードを持っておく必要がない
- 従って、SC 分の JS コード（レンダリング処理）を削減できる
- これにより、パフォーマンスが向上する

### データフェッチスピードの高速化

- SC はサーバで行う処理なので、当然データソースとの距離も近い
- 従って、クライアントから取得を行うよりも高速
- クライアントが行うデータリクエストの量も削減できる

### セキュリティ

- トークンや API キーなどの機密データやロジックをサーバだけで完結でき、サービスの安全性が向上する

### キャッシュ

- サーバでレンダリングされたコンポーネントのキャッシュを行う
- これにより、レンダリング時間やデータフェッチ量が削減され、リクエストから表示までが高速になる

## SSR との違い

## 使用ケース

SC と CC の使い分けの判断基準は、**サーバで処理した方が効率が良いコンポーネントかどうか？**という部分になる。
![](https://storage.googleapis.com/zenn-user-upload/6451055ce774-20230924.png)

## 参考リンク

https://qiita.com/naruto/items/c17c79ec5c2a0c7c4686
